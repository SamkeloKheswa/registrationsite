<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin - Hammarsdale Got Talent</title>
<style>
  body { font-family: Arial, sans-serif; background: #f4f4f4; margin:0; padding:0; }
  header { background: #ff6600; color: white; padding: 20px; text-align: center; }
  .login-box, .dashboard { max-width: 900px; margin: 30px auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 15px rgba(0,0,0,0.1); }
  h2 { text-align: center; }
  input, button { width: 100%; padding: 10px; margin: 10px 0; border-radius: 5px; border: 1px solid #ccc; }
  button { background: #28a745; color: white; border: none; cursor: pointer; font-weight: bold; }
  button:hover { background: #218838; }
  table { width: 100%; border-collapse: collapse; margin-top: 20px; }
  table, th, td { border: 1px solid #ccc; }
  th, td { padding: 10px; text-align: left; }
  th { cursor: pointer; background: #f2f2f2; }
  #search { margin-top: 15px; padding: 8px; width: 100%; border-radius: 5px; border: 1px solid #ccc; }
</style>
</head>
<body>

<header>
  <h1>Hammarsdale Got Talent - Admin Dashboard</h1>
</header>

<div class="login-box" id="loginBox">
  <h2>Admin Login</h2>
  <input type="text" id="username" placeholder="Username">
  <input type="password" id="password" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<div class="dashboard" id="dashboard" style="display:none;">
  <h2>Registrations</h2>
  <input type="text" id="search" placeholder="Search by Name or Talent" onkeyup="filterTable()">
  <table id="entriesTable">
    <thead>
      <tr>
        <th onclick="sortTable(0)">Name &#x25B2;&#x25BC;</th>
        <th onclick="sortTable(1)">Age &#x25B2;&#x25BC;</th>
        <th onclick="sortTable(2)">Contact &#x25B2;&#x25BC;</th>
        <th onclick="sortTable(3)">Talent &#x25B2;&#x25BC;</th>
        <th onclick="sortTable(4)">Description &#x25B2;&#x25BC;</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
const ADMIN_USER = "admin";
const ADMIN_PASS = "password123"; // Change this for security

function login() {
  let user = document.getElementById('username').value;
  let pass = document.getElementById('password').value;
  if(user === ADMIN_USER && pass === ADMIN_PASS) {
    document.getElementById('loginBox').style.display = "none";
    document.getElementById('dashboard').style.display = "block";
    fetchEntries();
  } else {
    alert("Invalid credentials!");
  }
}

async function fetchEntries() {
  try {
    let res = await fetch("/.netlify/functions/get-submissions");
    let entries = await res.json();
    let tbody = document.querySelector("#entriesTable tbody");
    tbody.innerHTML = "";
    entries.forEach(e => {
      let row = `<tr>
        <td>${e.data.fullname}</td>
        <td>${e.data.age}</td>
        <td>${e.data.contact}</td>
        <td>${e.data.talent}</td>
        <td>${e.data.description}</td>
      </tr>`;
      tbody.innerHTML += row;
    });
  } catch(err) {
    console.error(err);
    alert("Error fetching entries.");
  }
}

// Filter table by search input
function filterTable() {
  const input = document.getElementById("search").value.toLowerCase();
  const rows = document.querySelectorAll("#entriesTable tbody tr");
  rows.forEach(row => {
    let name = row.cells[0].textContent.toLowerCase();
    let talent = row.cells[3].textContent.toLowerCase();
    if(name.includes(input) || talent.includes(input)) {
      row.style.display = "";
    } else {
      row.style.display = "none";
    }
  });
}

// Sort table columns
function sortTable(n) {
  const table = document.getElementById("entriesTable");
  let rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
  switching = true; dir = "asc";
  while(switching) {
    switching = false;
    rows = table.rows;
    for(i=1; i<rows.length-1; i++) {
      shouldSwitch = false;
      x = rows[i].getElementsByTagName("TD")[n];
      y = rows[i+1].getElementsByTagName("TD")[n];
      if(dir === "asc" && x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) { shouldSwitch=true; break; }
      if(dir === "desc" && x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) { shouldSwitch=true; break; }
    }
    if(shouldSwitch) { rows[i].parentNode.insertBefore(rows[i+1], rows[i]); switching=true; switchcount++; }
    else if(switchcount===0 && dir==="asc") { dir="desc"; switching=true; }
  }
}
</script>

</body>
</html>
